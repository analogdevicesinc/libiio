# TEST PIPELINE - Quick test to verify cmakeBuildType variable
# This is a temporary test pipeline to verify variable values

variables:
  # Check if this is the main branch
  ${{ if eq(variables['Build.SourceBranch'], 'refs/heads/main') }}:
    isMain: true
  ${{ else }}:
    isMain: false
  # Check if this is a release tag
  ${{ if startsWith(variables['Build.SourceBranch'], 'refs/tags/v') }}:
    isRelease: true
  ${{ else }}:
    isRelease: false
  # Default build type for all builds
  ${{ if startsWith(variables['Build.SourceBranch'], 'refs/tags/v') }}:
    cmakeBuildType: 'Release'
  ${{ else }}:
    cmakeBuildType: 'RelWithDebInfo'

trigger:
  branches:
    include:
    - test-cmakeBuildType

pr: none

stages:
- stage: TestVariables
  jobs:
  - job: CheckVariables
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - script: |
        echo "======================================"
        echo "VARIABLE TEST RESULTS"
        echo "======================================"
        echo "Build.SourceBranch: $(Build.SourceBranch)"
        echo "isMain: $(isMain)"
        echo "isRelease: $(isRelease)"
        echo "cmakeBuildType: $(cmakeBuildType)"
        echo "======================================"
        echo ""
        echo "Expected for non-tag branch: cmakeBuildType=RelWithDebInfo"
        echo "Expected for tag (v*): cmakeBuildType=Release"
        echo ""
        if [ "$(cmakeBuildType)" = "RelWithDebInfo" ]; then
          echo "SUCCESS: cmakeBuildType is correctly set to RelWithDebInfo for non-tag build"
        elif [ "$(cmakeBuildType)" = "Release" ]; then
          echo "INFO: cmakeBuildType is Release (expected only for tag builds)"
        else
          echo "ERROR: cmakeBuildType has unexpected value: $(cmakeBuildType)"
          exit 1
        fi
      displayName: 'Test cmakeBuildType variable'
