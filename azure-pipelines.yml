# TEST PIPELINE - Verify compile-time vs runtime variable evaluation
# Testing if ${{ }} template expressions can access Build.SourceBranch

variables:
  # COMPILE-TIME: ${{ }} - evaluated BEFORE pipeline runs
  ${{ if eq(variables['Build.SourceBranch'], 'refs/heads/test-cmakeBuildType') }}:
    isTestBranch_compiletime: 'TRUE'
  ${{ else }}:
    isTestBranch_compiletime: 'FALSE'

  # RUNTIME: $[ ] - evaluated WHEN pipeline runs
  isTestBranch_runtime: $[eq(variables['Build.SourceBranch'], 'refs/heads/test-cmakeBuildType')]

trigger:
  branches:
    include:
    - test-cmakeBuildType

pr: none

stages:
- stage: TestVariables
  jobs:
  - job: CheckVariables
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - script: |
        echo "======================================"
        echo "COMPILE-TIME vs RUNTIME TEST"
        echo "======================================"
        echo ""
        echo "Build.SourceBranch (actual): $(Build.SourceBranch)"
        echo ""
        echo "--- COMPILE-TIME template expression ---"
        echo "isTestBranch_compiletime: $(isTestBranch_compiletime)"
        echo ""
        echo "--- RUNTIME expression ---"
        echo "isTestBranch_runtime: $(isTestBranch_runtime)"
        echo ""
        echo "======================================"
        echo "EXPECTED: Both should be TRUE for test-cmakeBuildType branch"
        echo "If compile-time is FALSE but runtime is True,"
        echo "then Build.SourceBranch is NOT available at compile time!"
        echo "======================================"
      displayName: 'Compare compile-time vs runtime'
